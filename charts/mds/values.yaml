# Default values for mds.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
nameOverride: ""
fullnameOverride: "mds"
namespace: "boreal-system"

# MDS deployment configuration
deployment:
  environment: "production"
  mds-environment: "byoc-org_1234"
  cloud-provider: "gcp"
  replicaCount: 1
  image:
    repository: "us-central1-docker.pkg.dev/moose-hosting-node/hosting/mds"
    tag: ""
    pullPolicy: Always

# Service account configuration
serviceAccount:
  name: "mds"
  annotations: {}

# Branch configuration for MDS
# Each branch can have: computeClass, pod, service, customDomains
branchConfig:
  branchIds: {}
    # Example configuration:
    # "example-branch-id":
    #   computeClass:
    #     key: "cloud.google.com/compute-class"
    #     value: "Balanced"
    #   pod:
    #     cpu: "4"
    #     memory: "8G"
    #   service:
    #     replicas: 1
    #   customDomains:  # Optional
    #     - "custom.example.com"

# OpenTelemetry configuration
opentelemetry:
  enabled: false
  collector:
    image: "otel/opentelemetry-collector-contrib:0.126.0"
    mode: "sidecar"

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1001
  allowPrivilegeEscalation: false

# Resources for MDS containers
resources:
  requests:
    cpu: 500m
    memory: 1024Mi

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules - Pod anti-affinity is configured in the deployment template
affinity: {}

# Environment configuration
environment:
  # Boreal configuration
  boreal:
    webHostingUrl: "https://boreal.cloud"
    webhookSecret: ""

  # MDS-specific configuration
  mds:
    # Default compute resources for Moose pods
    podDefaultCpu: "500m"  # 1/2 vCPU
    podDefaultMemory: "1024Mi"
    # OpenTelemetry logging configuration
    otelLogs:
      enabled: false
      endpoint: "https://telemetry.internal.boreal.cloud/ingest/openTelemetryLogs/0.0"

# Secrets configuration - these should be created separately or provided
secrets:
  # AWS secrets
  aws:
    enabled: false
    name: "sn-mds-aws-config"
    data:
      region: "us-east-2"
      access-key-id: ""
      secret-access-key: ""
      boreal-connection-hub-vpc-endpoint-service-name: ""
  redis:
    enabled: false
    name: "sn-redis-config"
    data:
      connection-string: ""
      mds-cluster-prefix: ""
      mds-request-channel: "mds-request"
  pulumi:
    enabled: false
    name: "sn-mds-pulumi-config"
    data:
      organization: "514labs"
      passphrase: ""
      access-token: ""
  temporal:
    enabled: false
    name: "sn-mds-temporal-config"
    data:
      # This is a JWT token, keeping it as is
      api-key: ""
      namespace-region: "gcp-us-west1"
      namespace-retention-days: "30"
  redpanda:
    enabled: false
    name: "sn-mds-redpanda-config"
    data:
      uses-cloud-service: "true"
      auth-url: "https://auth.prd.cloud.redpanda.com/oauth/token"
      client-id: ""
      client-secret: ""
      cluster-api-url: ""
      sasl-admin-username: "moose"
      sasl-admin-password: ""
      broker: ""
      sasl-mechanism: "PLAIN"
      replication-factor: "3"
      message-timeout-ms: "300000"
      security-protocol: "SASL_SSL"
  clickhouse:
    enabled: false
    name: "sn-mds-clickhouse-config"
    data:
      ### Cloud configuration
      cloud-provider: "gcp"
      cloud-region: "us-central1"
      org-id: ""
      token-key: ""
      token-secret: ""
      ### Non-cloud configuration
      host: ""
      host-http-port: ""
      admin-username: "default"
      admin-password: ""

  # Default Moose Pod configuration
  defaultMoosePod:
    name: "sn-mds-moose-pod-default-config"
    data:
      cpu: "500m"
      memory: "1024Mi"

  # Boreal webhook secrets
  borealWebhook:
    name: "boreal-webhook-secret"  # Updated to match cluster
    data:
      secret: ""

  # Image pull secret for private container registries
  imagePull:
    enabled: false
    name: "sn-mds-image-pull-secret"
    data:
      # Base64 encoded Docker config JSON
      # IMPORTANT: This should be base64 encoded JSON, NOT a base64 encoded string
      #
      # Method 1 - From existing docker-config.json file:
      #   cat docker-config-30cI9M4reuGKbT6mDiYKHikTiR5.json | base64
      #
      # Method 2 - Using kubectl:
      #   kubectl create secret docker-registry temp-secret \
      #     --docker-server=<registry> \
      #     --docker-username=<username> \
      #     --docker-password=<password> \
      #     --dry-run=client -o yaml | grep .dockerconfigjson | awk '{print $2}'
      #
      # DO NOT use jq '@json' as it will double-encode the content
      dockerConfigJson: ""

# Staging-specific environment variables
staging:
  github514CommercialRepoId: ""

# Datadog configuration (for OpenTelemetry)
datadog:
  enabled: false
  apiKey: ""
